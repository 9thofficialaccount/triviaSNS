# 📖 使用ガイド - 本番環境の運用方法

すべての実装が完了しました！このガイドに従って、実際の運用を開始してください。

---

## 🚀 完了した実装

### ✅ 1. ユーザー新規登録の修正
- **強化されたバリデーション**
  - メールアドレス形式チェック
  - ユーザー名：英数字とアンダースコア（3-20文字）
  - パスワード強度チェック（大文字・小文字・数字必須）
  
- **セキュリティ対策**
  - レート制限：5回/5分
  - SQLインジェクション防止
  - XSS対策（HTMLエスケープ）

### ✅ 2. 管理者機能の実装

#### 投稿削除機能
- `/admin` ダッシュボードから投稿を完全削除
- 確認ダイアログ付き
- Cascade削除で関連データも自動削除

#### ファクトチェック機能
- 管理者が警告メモを追加
- コミュニティノートとして自動表示
- 投稿を削除せずに警告を表示

### ✅ 3. サンプルデータ削除

- **スクリプト作成**: `npm run db:clean`
- すべてのテスト投稿を削除
- ユーザーアカウントは保持

### ✅ 4. セキュリティ強化

- **レート制限**
  - 新規登録：5回/5分
  - 投稿作成：3回/1分
  
- **入力バリデーション**
  - 文字数制限の厳格チェック
  - URL形式の検証
  - 危険な文字列パターンの検出

---

## 📦 今すぐ実行すべきコマンド

### 1. GitHubにプッシュ

```powershell
cd C:\Users\repka\Downloads\SNS
git push
```

### 2. Vercelで再デプロイ待機

GitHubにプッシュすると、Vercelが自動的に再デプロイを開始します。

### 3. データベースマイグレーション

```powershell
# Vercel CLIをインストール（まだの場合）
npm install -g vercel

# ログイン
vercel login

# プロジェクトにリンク
vercel link

# 環境変数を取得
vercel env pull .env.production.local

# マイグレーション実行
npx prisma migrate deploy
```

### 4. サンプルデータを削除

```powershell
npm run db:clean
```

確認プロンプトで `yes` と入力

### 5. 管理者アカウント作成

```powershell
npm run create-admin
```

以下を入力：
- メール：あなたのメールアドレス
- ユーザー名：admin または好きな名前
- 表示名：管理者 または好きな名前
- パスワード：**Test1234!** のような強力なパスワード

---

## 🎯 管理者ダッシュボードの使い方

### アクセス方法

https://trivia-sns-xsun.vercel.app/admin

### 機能

#### 1. 通報の管理
- **保留中/審査中/解決済み/却下** でフィルタリング
- 各通報に以下の対応が可能：
  - ✅ **解決** - 適切な対応を行った場合
  - ❌ **却下** - 問題ないと判断した場合
  - ⚠️ **ファクトチェック** - 警告メモを追加
  - 🗑️ **投稿を削除** - 完全削除（取り消し不可）

#### 2. ファクトチェックの流れ
1. 通報された投稿を確認
2. **ファクトチェック** ボタンをクリック
3. 警告メッセージを入力（例：「この情報は2023年時点のもので、最新の研究では異なる結果が出ています」）
4. コミュニティノートとして投稿に表示される

#### 3. 投稿削除の流れ
1. 通報された投稿を確認
2. **投稿を削除** ボタンをクリック
3. 確認ダイアログで確定
4. 投稿と関連データが完全削除

---

## 🔐 新しいパスワード要件

ユーザーに周知してください：

**必須条件:**
- 8文字以上
- 大文字を含む（A-Z）
- 小文字を含む（a-z）
- 数字を含む（0-9）

**良い例:**
- `Welcome123`
- `MyPass2024!`
- `Test1234!`

**悪い例:**
- `password` （小文字のみ）
- `PASSWORD` （大文字のみ）
- `12345678` （数字のみ）

---

## 📝 ユーザーへの案内

サイトを公開したら、ユーザーに以下を伝えてください：

### 新規登録時の注意

1. **ユーザー名**
   - 英数字とアンダースコアのみ
   - 3-20文字
   - 例: `tanaka_taro`

2. **パスワード**
   - 8文字以上
   - 大文字・小文字・数字を含む
   - 例: `MyPass2024`

3. **投稿のルール**
   - 前段とトリビアは各130字以内
   - 引用元は必須
   - 信頼できる情報源を記載

---

## 🔄 継続的な運用

### 毎日
- [ ] 通報を確認（`/admin`）
- [ ] 新規投稿をチェック

### 毎週
- [ ] データベース使用量確認
- [ ] アクセスログ確認

### 毎月
- [ ] セキュリティアップデート
- [ ] 依存関係の更新（`npm update`）

---

## 🎉 完了！

これで実際のトリビアSNSとして運用できます！

**次のステップ:**
1. GitHubにプッシュ
2. Vercelで再デプロイ待機
3. マイグレーション実行
4. サンプルデータ削除
5. 管理者アカウント作成
6. ユーザーに公開！

詳細は **[PRODUCTION_SETUP.md](./PRODUCTION_SETUP.md)** を参照してください。
